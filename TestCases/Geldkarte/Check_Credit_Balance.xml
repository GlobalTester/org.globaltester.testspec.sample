<?xml version="1.0" encoding="UTF-8"?>
<TestCase id="Check_Credit_Balance" xmlns="http://globaltester.org/testspecification" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://globaltester.org/schema/testspecification.xsd">
	<Title>Check_Credit_Balance</Title>
	<Version>1.00</Version>
	<Purpose>Try to find out if the attached card is a ec card (eletronic cash - money card)</Purpose>
	<Profile></Profile>
	<Reference></Reference>
	<Precondition>
		<Command>
			<Text>Perform a cold reset of the card in order to ensure all temporary data is removed</Text>
		</Command>
		<TechnicalCommand>
			card.gt_reset();
		</TechnicalCommand>
	</Precondition>
	<TestStep>
		<Command xsi:type="APDUCommand">
			<Text>Select the MF (Master File) with returning {fcp} (file control parameters)</Text>
			<APDU sm="false">00 A4 00 04 {lc} {fid} {le}</APDU>
		</Command>
		<Description>{fid} defines the file ID</Description>
		<TechnicalCommand>
			var command = new ByteString("00 A4 00 04 02 3F 00 00", HEX);
			var fcp = card.gt_sendCommand(command);
		</TechnicalCommand>
		<ExpectedResult xsi:type="APDUResult">
			<Text>The select command return a byte string with first byte as '62' identifying FCP template</Text>
			<APDU sm="false">{fcp} 90 00</APDU>
			<TechnicalResult>
				assertStatusWord(SW_NoError, card.SW.toString(HEX), FAILURE); 
				assertMatchValue("62", fcp.bytes(0,1), FAILURE);
			</TechnicalResult>
		</ExpectedResult>
	</TestStep>
	<TestStep>
		<Command xsi:type="APDUCommand">
			<Text>Select card application with AID</Text>
			<APDU sm="false">00 A4 04 04 {lc} {aid} {le}</APDU>
		</Command>
		<Description>Select the eC card application with following {aid} in a plain SELECT Application APDU</Description>
		<TechnicalCommand>
			var aid = new ByteString("D2 76 00 00 25 45 50 02 00",HEX); 
			var fci = card.gt_ISO7816_selectAID(aid);
		</TechnicalCommand>
		<ExpectedResult xsi:type="APDUResult">
			<Text>The select command return a byte string with first byte as '6F' identifying FCI template</Text>
			<APDU sm="false">{fci} 90 00</APDU>
			<TechnicalResult>
				assertStatusWord(SW_NoError, card.SW.toString(HEX), FAILURE); 
				assertMatchValue("6F", fci.bytes(0,1), FAILURE);
			</TechnicalResult>
		</ExpectedResult>
	</TestStep>
	<TestStep>
		<Command xsi:type="APDUCommand">
			<Text>Select record based file with file ID</Text>
			<APDU sm="false">00 A4 02 04 {lc} {fid} 00</APDU>
		</Command>
		<Description>{fid} defines the file ID</Description>
		<TechnicalCommand>
			var command = new ByteString("00 A4 02 04 02 01 04 00", HEX);
			var fcp = card.gt_sendCommand(command);
		</TechnicalCommand>
		<ExpectedResult xsi:type="APDUResult">
			<Text>The select command return a byte string {fcp} (file control parameters) with first byte as '62'</Text>
			<APDU sm="false">{fcp} 90 00</APDU>
			<TechnicalResult>
				assertStatusWord(SW_NoError, card.SW.toString(HEX), FAILURE); 
				assertMatchValue("62", fcp.bytes(0,1), FAILURE);
			</TechnicalResult>
		</ExpectedResult>
	</TestStep>
	<TestStep>
		<Command xsi:type="APDUCommand">
			<Text>Read record with record no. 1</Text>
			<APDU sm="false">00 B2 01 04 00</APDU>
		</Command>
		<TechnicalCommand>
			var command = new ByteString("00 B2 01 04 00", HEX);
			var response = card.gt_sendCommand(command);
		</TechnicalCommand>
		<ExpectedResult xsi:type="APDUResult">
			<APDU sm="false">90 00</APDU>
			<Text>The read record command returns a ByteString. In the ByteString the rest on cash money on the card is coded.</Text>
			<TechnicalResult><![CDATA[
				assertStatusWord(SW_NoError, card.SW.toString(HEX), FAILURE);
				assertBiggerOrEqual("00", response.bytes(1,1), FAILURE); <!-- EUROS -->
				assertBiggerOrEqual("00", response.bytes(2,1), FAILURE); <!-- CENT  -->
			]]></TechnicalResult>
		</ExpectedResult>
	</TestStep>
</TestCase>